// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client/phone"
}

datasource db {
  provider = "postgresql"
  url      = env("PHONE_DB_URL")
}

model Brand {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted Boolean  @default(false) @map("is_deleted")

  phones    Phone[]

  @@map("brands")
}


model Category {
  id        Int        @id @default(autoincrement())
  name      String     @db.VarChar(100)
  parentId  Int?       @map("parent_id")
  createdAt DateTime   @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime   @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted Boolean    @default(false) @map("is_deleted")

  parent    Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  
  children  Category[] @relation("CategoryToCategory")
  phones    Phone[]

  @@map("categories")
}

model Phone {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  brandId     Int      @map("brand_id")
  categoryId  Int      @map("category_id")
  description String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt   DateTime @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted   Boolean  @default(false) @map("is_deleted")

  brand       Brand    @relation(fields: [brandId], references: [id])
  category    Category @relation(fields: [categoryId], references: [id])

  variants    PhoneVariant[]
  reviews     Review[]

  @@index([brandId])
  @@index([categoryId])
  @@map("phones")
}

model Color {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(50)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted Boolean  @default(false) @map("is_deleted")

  variants  PhoneVariant[]

  @@map("colors")
}

model PhoneVariant {
  id             Int      @id @default(autoincrement())
  phoneId        Int      @map("phone_id")
  variantName    String   @db.VarChar(100)
  colorId        Int      @map("color_id")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt      DateTime @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted      Boolean  @default(false) @map("is_deleted")

  phone          Phone    @relation(fields: [phoneId], references: [id])
  color          Color    @relation(fields: [colorId], references: [id])

  prices         VariantPrice[]
  discounts      VariantDiscount[]
  images         VariantImage[]
  inventories    Inventory[]
  specifications VariantSpecification[]

  @@index([phoneId])
  @@index([colorId])
  @@map("phone_variants")
}

model VariantPrice {
  id        Int          @id @default(autoincrement())
  variantId Int          @map("variant_id")
  price     Decimal      @db.Decimal(10,2)
  startDate DateTime     @map("start_date") @db.Timestamptz()
  endDate   DateTime?    @map("end_date") @db.Timestamptz()
  createdAt DateTime     @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime     @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted Boolean      @default(false) @map("is_deleted")
  
  variant   PhoneVariant @relation(fields: [variantId], references: [id])

  @@index([variantId])
  @@map("variant_prices")
}

model VariantDiscount {
  id              Int          @id @default(autoincrement())
  variantId       Int          @map("variant_id")
  discountPercent Decimal      @db.Decimal(5,2)
  startDate       DateTime     @map("start_date") @db.Timestamptz()
  endDate         DateTime?    @map("end_date") @db.Timestamptz()
  createdAt       DateTime     @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt       DateTime     @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted       Boolean      @default(false) @map("is_deleted")

  variant         PhoneVariant @relation(fields: [variantId], references: [id])

  @@index([variantId])
  @@map("variant_discounts")
}

model VariantImage {
  id        Int          @id @default(autoincrement())
  variantId Int          @map("variant_id")
  imageUrl  String       @db.VarChar(255) @map("image_url")
  createdAt DateTime     @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime     @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted Boolean      @default(false) @map("is_deleted")

  variant   PhoneVariant @relation(fields: [variantId], references: [id])

  @@index([variantId])
  @@map("variant_images")
}

model Specification {
  id        Int      @id @default(autoincrement())
  name      String   @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted Boolean  @default(false) @map("is_deleted")

  variants  VariantSpecification[]

  @@map("specifications")
}

model VariantSpecification {
  variantId     Int           @map("variant_id")
  specId        Int           @map("spec_id")
  info          String        @db.VarChar(255)
  valueNumeric  Float?        @map("value_numeric")
  unit          String?       @map("unit")
  createdAt     DateTime      @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt     DateTime      @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted     Boolean       @default(false) @map("is_deleted")

  variant       PhoneVariant  @relation(fields: [variantId], references: [id])
  specification Specification @relation(fields: [specId], references: [id])

  @@id([variantId, specId])
  @@map("variant_specifications")
}

model Inventory {
  id            Int          @id @default(autoincrement())
  variantId     Int          @map("variant_id")
  sku           String       @db.VarChar(50)
  stockQuantity Int          @map("stock_quantity")
  createdAt     DateTime     @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt     DateTime     @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted     Boolean      @default(false) @map("is_deleted")

  variant       PhoneVariant @relation(fields: [variantId], references: [id])

  @@index([variantId])
  @@map("inventories")
}

model Review {
  id         Int      @id @default(autoincrement())
  orderId    Int      @map("order_id")
  customerId Int      @map("customer_id")
  phoneId    Int      @map("phone_id")
  rating     Int
  comment    String?  @db.VarChar(255)
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz()
  updatedAt  DateTime @default(now()) @map("updated_at") @db.Timestamptz()
  isDeleted  Boolean  @default(false) @map("is_deleted")

  phone      Phone     @relation(fields: [phoneId], references: [id])

  @@unique([customerId, orderId, phoneId])
  @@index([orderId])
  @@index([customerId])
  @@index([phoneId])
  @@map("reviews")
}